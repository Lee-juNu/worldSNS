<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.worlds.board.BoardMapper">

<insert id="boardInsert" parameterType="com.team.worlds.board.Board">
	<selectKey keyProperty="board_Num" resultType="string" order="BEFORE">
		select board_seq.nextval from dual
	</selectKey>
	insert into boardTbl values(#{board_Num},#{board_ParentNum},#{board_userID},
	#{board_img1},#{board_img2},#{board_img3},#{board_img4},#{board_Contents},#{board_Country},#{board_City},sysdate, 0)
</insert>



<select id="getBoardByNum" parameterType="map" resultType="com.team.worlds.board.BoardOutput">
	select user_nickName, boardTbl.*,like_BoardNum
	 	from USERTBL,boardTbl,liketbl
	 		where board_userId = #{userId}
	 		and user_id = board_userId and like_BoardNum(+) = board_num and board_num = #{boardNum}
			order by  board_regdate desc
</select>



<select id="getBoardByFollower" resultType="com.team.worlds.board.BoardOutput">
select * from(
select ROWNUM rn, user_nickName, like_BoardNum,Board_Num,Board_ParentNum,board_userID,
Board_img1,Board_img2,Board_img3,Board_img4,Board_Contents,Board_Country,Board_City,likeCount,board_regdate
from
(select user_nickName, boardTbl.*,like_BoardNum
	 	from USERTBL,boardTbl,liketbl
	 		where board_userId in 
	 		(select Flw_toId from followTbl,USERTBL where Flw_FromId = #{user_ID} or board_userId = #{user_ID})
	 		and user_id = board_userId and like_SenderID(+)= #{user_ID} and like_BoardNum(+) = board_num
	 		ORDER BY board_regdate desc
	 		)) 
	 		WHERE rn BETWEEN to_number(#{pageSize}) * (to_number(#{page}) - 1) + 1 AND to_number(#{pageSize})*to_number(#{page})
</select>



<select id = "getBoardByFollowerAndRegion" resultType="com.team.worlds.board.BoardOutput">
select * from(
select ROWNUM rn, user_nickName, like_BoardNum,Board_Num,Board_ParentNum,board_userID,
Board_img1,Board_img2,Board_img3,Board_img4,Board_Contents,Board_Country,Board_City,likeCount,board_regdate
from
(select user_nickName, boardTbl.*,like_BoardNum
	from USERTBL,boardTbl,liketbl
	where board_userId in 
	(select Flw_toId from followTbl,USERTBL 
	where Flw_FromId = #{user_ID} or board_userId = #{user_ID})
	and user_id = board_userId and like_SenderID(+)= #{user_ID} 
	and like_BoardNum(+) = board_num and Board_City = #{region}
	 order by  board_regdate desc))
WHERE rn BETWEEN to_number(#{pageSize}) * (to_number(#{page}) - 1) + 1 AND
 to_number(#{pageSize})*to_number(#{page})
</select>

<select id = "getBoardByFollowerAndCountry" resultType="com.team.worlds.board.BoardOutput">
</select>


<delete id="boardDelete">
	DELETE BOARDTBL WHERE BOARD_NUM= #{user_id}
</delete>

</mapper>
